<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surat Untukmu</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="style.css">

    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
</head>
<body>

    <div class="container-center" style="display:flex; flex-direction:column; align-items:center; padding: 30px 0;">
        
        <div class="gameboy">
            <div class="gb-header">
                <div class="power-indicator"><div class="power-light"></div> POWER</div>
                <div class="brand-top">HI Wilona</div>
            </div>

            <div class="screen-area">
                <div class="screen-cover">
                    <div class="battery-label">üî¥ BATTERY</div>
                    
                    <div class="screen-display message-screen">
                        <h3 class="pixel-title">Message</h3>
                        
                        <div id="typing-box" class="typing-area"></div>

                        <button id="skip-btn" class="btn-skip" onclick="finishTyping()">SKIP >></button>
                        
                        <div id="nav-buttons" class="nav-hidden">
                            <button class="btn-action btn-next" onclick="window.location.href='gallery.html'">SELANJUTNYA</button>
                            <button class="btn-action btn-back" onclick="window.location.href='index.html'">KEMBALI</button>
                        </div>
                    </div>
                    
                    <div class="screen-text-bottom">DOT MATRIX WITH STEREO SOUND</div>
                </div>
            </div>

            <div class="game-controls-bottom">
                <div class="d-pad"><div class="d-pad-h"></div><div class="d-pad-v"></div></div>
                <div class="action-buttons-group">
                    <div class="round-btn" style="margin-top:15px">B</div>
                    <div class="round-btn" style="margin-bottom:5px">A</div>
                </div>
            </div>
            <div class="speaker-grill"><span></span><span></span><span></span><span></span><span></span><span></span></div>
        </div>

        <div class="comment-section">
            <h4>WISHES FROM FRIENDS</h4>
            
            <div class="comment-list" id="comment-list">
                Loading comments...
            </div>
            
            <div class="input-group">
                <input type="text" id="nameInput" placeholder="Nama kamu...">
                <textarea id="msgInput" placeholder="Tulis ucapan..."></textarea>
                <button class="send-btn" onclick="addComment()">KIRIM UCAPAN</button>
            </div>
        </div>
    </div>

    <script>
        // --- 1. SETUP PESAN & ANIMASI KETIK ---
        // Kamu bisa mengedit isi pesan di dalam tanda kutip (`) di bawah ini:
        const fullText = `Hi Wilona Felita Delfina,\n\nHappy Birthday!\n\nHari ini aku pengen kamu ngerasain semua hal positif dan keajaiban yang sama kaya yang aku dapetin pas kamu ada di dunia ini.\n\nSemoga segala keinginanmu tercapai, apalagi yang keren-keren dan gak biasa. Karena kamu tuh unik banget! Aku selalu bersyukur bisa melihat kamu jadi versi terbaik dari dirimu.\n\nTetap jadi orang yang tulus dan ceria ya! Love you! ‚ù§Ô∏è\n\n(P.S. Kamu bisa scroll teks ini jika kepanjangan)`;

        const typingBox = document.getElementById('typing-box');
        const skipBtn = document.getElementById('skip-btn');
        const navButtons = document.getElementById('nav-buttons');
        let i = 0; 
        let typingSpeed = 50; 
        let timer;

        function typeWriter() {
            if (i < fullText.length) {
                // Ganti baris baru (\n) dengan tag <br> HTML
                typingBox.innerHTML += fullText.charAt(i) === '\n' ? '<br>' : fullText.charAt(i);
                i++;
                typingBox.scrollTop = typingBox.scrollHeight; // Auto scroll ke bawah
                timer = setTimeout(typeWriter, typingSpeed);
            } else { 
                finishTyping(); 
            }
        }

        function finishTyping() {
            clearTimeout(timer);
            typingBox.innerHTML = fullText.replace(/\n/g, "<br>");
            skipBtn.style.display = 'none';
            navButtons.classList.remove('nav-hidden');
            navButtons.classList.add('nav-show');
        }

        // --- 2. FIREBASE CONFIG (PENTING!) ---
        // Pastikan kamu mengganti bagian ini dengan Config dari Firebase Console kamu
        const firebaseConfig = {
            apiKey: "AIzaSy...", // <-- GANTI DENGAN API KEY KAMU
            authDomain: "tes-a-78adf.firebaseapp.com",
            databaseURL: "https://tes-a-78adf-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "tes-a-78adf",
            storageBucket: "tes-a-78adf.appspot.com",
            messagingSenderId: "...",
            appId: "..."
        };

        // Inisialisasi Firebase
        if (!firebase.apps.length) { 
            firebase.initializeApp(firebaseConfig); 
        }
        const database = firebase.database();

        // --- 3. LOGIKA KOMENTAR ---
        const commentList = document.getElementById('comment-list');
        
        // Mengambil data komentar (limit 20 terakhir)
        database.ref('comments').limitToLast(20).on('value', (snapshot) => {
            commentList.innerHTML = '';
            const data = snapshot.val();
            
            if(data){
                // Ubah object jadi array dan balik urutan (terbaru di atas)
                Object.values(data).reverse().forEach(c => {
                    const div = document.createElement('div');
                    div.className = 'comment-item';
                    // Mencegah kode HTML berbahaya (XSS basic protection)
                    const safeName = c.name.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    const safeText = c.text.replace(/</g, "&lt;").replace(/>/g, "&gt;");
                    
                    div.innerHTML = `<strong>${safeName}:</strong> ${safeText}`;
                    commentList.appendChild(div);
                });
            } else { 
                commentList.innerHTML = '<p style="padding:10px;">Belum ada ucapan.</p>'; 
            }
        });

        // Fungsi Mengirim Komentar
        function addComment() {
            const nameInput = document.getElementById('nameInput');
            const msgInput = document.getElementById('msgInput');
            const name = nameInput.value;
            const text = msgInput.value;

            if(name.trim() && text.trim()) {
                database.ref('comments').push({
                    name: name, 
                    text: text, 
                    timestamp: Date.now()
                });
                
                // Reset form
                nameInput.value = '';
                msgInput.value = '';
            } else { 
                alert("Isi nama & pesan dulu ya!"); 
            }
        }

        // Jalankan animasi ketik saat halaman selesai dimuat
        window.onload = typeWriter;
    </script>
</body>
</html>